From 4da3a17dab494958e3fb168fbeebe4b0b8a3fe30 Mon Sep 17 00:00:00 2001
From: Brett Grandbois <brett.grandbois@opengear.com>
Date: Thu, 3 May 2018 15:30:20 +1000
Subject: [PATCH 07/23] discover/grub: Add cmdline signature support for BLS
 entries

Follow along the way the linux builtin does it.

Signed-off-by: Brett Grandbois <brett.grandbois@opengear.com>
Signed-off-by: Samuel Mendoza-Jonas <sam@mendozajonas.com>
(cherry picked from commit fa44993a61fc7ca0f3f73233ebf761dabfd5a1fa)
Signed-off-by: Klaus Heinrich Kiwi <klaus@linux.vnet.ibm.com>
---
 discover/grub2/blscfg.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/discover/grub2/blscfg.c b/discover/grub2/blscfg.c
index 2e60f5e..7709324 100644
--- a/discover/grub2/blscfg.c
+++ b/discover/grub2/blscfg.c
@@ -148,6 +148,12 @@ static void bls_finish(struct conf_context *conf)
 		opt->dtb = create_grub2_resource(opt, conf->dc->device,
 						 root, state->dtb);
 
+	char* args_sigfile_default = talloc_asprintf(opt,
+		"%s.cmdline.sig", state->image);
+	opt->args_sig_file = create_grub2_resource(opt, conf->dc->device,
+						root, args_sigfile_default);
+	talloc_free(args_sigfile_default);
+
 	option->is_default = option_is_default(state, option);
 
 	list_add_tail(&state->script->options, &opt->list);
-- 
2.17.1

